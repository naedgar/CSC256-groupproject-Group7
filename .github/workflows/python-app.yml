name: Python application

on:
  push:
    branches: [ "main" ]
    paths-ignore:
      - '**.md'
      - 'docs/**'
      - 'README*'
  pull_request:
    branches: [ "main" ]
    paths-ignore:
      - '**.md'
      - 'docs/**'
      - 'README*'

  name: Python application
  
  on:
    push:
      branches: [ "main" ]
      paths-ignore:
        - '**.md'           # Skip running CI if only markdown files change
        - 'docs/**'         # Skip if only docs are updated
        - '**.rst'          # Skip reStructuredText files
        - 'LICENSE'         # Skip license updates
        - '.gitignore'      # Skip gitignore-only changes
        - 'README*'         # Skip README edits
    pull_request:
      branches: [ "main" ]
      paths-ignore:
        - '**.md'
        - 'docs/**'
        - '**.rst'
        - 'LICENSE'
        - '.gitignore'
        - 'README*'
  
  jobs:
    build:  # üî® Job name
      runs-on: ubuntu-latest  # üñ•Ô∏è This job will run in a virtual machine with Ubuntu
  
      steps:
        # Step 1: Get your code
        - name: Checkout Repository
          uses: actions/checkout@v4
        # üìÇ This downloads your repository's files into the CI environment
  
        # Step 2: Set up Python
        - name: Set up Python
          uses: actions/setup-python@v5
          with:
            python-version: "3.13.5"  # Python version must match your local dev environment
  
        # Step 3: Install dependencies
        - name: Install dependencies
          run: |
            python -m pip install --upgrade pip  # Upgrade pip
            pip install -r requirements.txt      # Install all Python packages listed in requirements.txt
  
        # Step 4: Run tests with coverage tracking
        - name: Run tests with coverage (unit + integration)
          run: |
            # Run only unit and integration tests for the primary workflow
            pytest -m "unit or integration" --cov=app --cov-report=term-missing
            # This measures coverage only for unit+integration tests
  
        # (Optional) Step 5: Enforce a minimum test coverage percentage
        # - name: Enforce minimum coverage
        #   run: |
        #     coverage report --fail-under=80
        #     # ‚ùå This will fail the build if total coverage is below 80%
  
        # (Optional) Step 6: Save the HTML version of the coverage report as an artifact
        # - name: Upload coverage HTML report
        #   uses: actions/upload-artifact@v3
        #   with:
        #     name: coverage-html
        #     path: htmlcov/
        #     # üìÅ This allows you to download and view the full HTML coverage report after CI runs
        # Note: Unit + integration tests are already executed by the coverage step above.
        # E2E/UI tests (Playwright/Selenium/Robot) should run in separate workflow files
        # (e.g. .github/workflows/e2e-tests.yml) with path filters and manual dispatch.
